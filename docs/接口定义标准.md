# 接口定义文档
## 一、用户管理模块
### 1、用户注册
注:br渲染为换行符<br>
1.接口描述：用户输入用户名和密码，执行注册<br>
2.接口类型：Flask route<br>
3.请求方式：POST<br>
4.请求路径：/api/auth/register<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_name: string;
    password: string
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        user_id: number
        coins: number
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status: 
    fail:400(传递数据错误)、409(用户名冲突)、500(服务器错误)
    ok:201(注册成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-08

---

### 2、用户登录
1.接口描述：用户输入用户名和密码，执行登录<br>
2.接口类型：Flask route<br>
3.请求方式：POST<br>
4.请求路径：/api/auth/login<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_name: string;
    password: string
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        user_id: number
        coins: number
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、401(登录失败)、500(服务器错误)
    ok:200(登录成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-08

---

### 3、获取用户信息
1.接口描述：用户点击头像，进入个人页面<br>
2.接口类型：Flask route<br>
3.请求方式：GET<br>
4.请求路径：/api/user<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number 
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        coins: number
        bar_possess: number
        total_games: number
        win_games: number
        win_rate: number
        picture: string
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、404(用户不存在)、500(服务器错误)
    ok:200(获取成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-08

---

## 二、球杆管理模块
### 4、获取球杆列表(商城信息)
1.接口描述：用户点击商城，显示所有球杆<br>
2.接口类型：Flask route<br>
3.请求方式：GET<br>
4.请求路径：/api/bar/list<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        "bar_possess":[{"bar_id": number, "bar_name":string", "price":number}...]
        "bar_npossess":[{"bar_id": number, "bar_name":string", "price":number}...]
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、404(用户不存在)、500(服务器错误)
    ok:200(获取成功)
}<br>
注：bar_possess代表**拥有**的所有球杆的信息，另一个则是未拥有的，两者均为字典列表<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-08

---

### 5、用户购买球杆
1.接口描述：用户点击球杆，进行购买<br>
2.接口类型：Flask route<br>
3.请求方式：POST<br>
4.请求路径：/api/bar/buy<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number
    bar_id: number
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        coins: number;
        bar_possess: number
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、404(用户或球杆不存在)、409(购买失败)、500(服务器错误)
    ok:200(购买成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-08

---

## 三、房间管理模块
### 6、用户创建房间
1.接口描述：用户点击创建，服务器端生成对应房间<br>
2.接口类型：Flask route<br>
3.请求方式：POST<br>
4.请求路径：/api/room/create<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    data: {}(fail)、{
        room_id: number
    }(ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、404(用户不存在)、409(用户有未退出的房间)、500(服务器错误)
    ok:200(创建成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-09

---

### 7、非创建者进入房间(仅更新数据库)
1.接口描述：非创建者进入房间，仅更新数据库<br>
2.接口类型：Flask route<br>
3.请求方式：POST<br>
4.请求路径：/api/room/join<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number
    room_id: number
}
- 服务器端->客户端:
{
    message: string(fail/ok);
    error: string['detail'(fail)、''(ok)]
    status:
    fail:400(传递数据错误)、404(用户不存在或房间状态异常)、500(服务器错误)
    ok:200(进入成功)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-09

---

### 8、用户进入房间(实时通信)
1.接口描述：用户进入房间，服务器进行播报<br>
2.接口类型：Flask socketio<br>
3.事件名：join_room<br>
4.请求方式：客户端通过 socket.emit("join_room", data) 发送，在创建房间和加入房间(接口6、7)调用后，再调用此函数<br>
5.通信接口定义:<br>
- 客户端->服务器端:
{
    user_id: number
    room_id: number
}
- 服务器端->客户端:
{
    event:ok(创建者进入)/fail(进入失败)/game start(第二个玩家进入)
    data:{
        error: 'detail'(fail)
        room_id: number(ok、gamestart)
        player1_id: number(game start)
        player2_id: number(game start)
    }
        注：number(ok、gamestart)代表当event为ok/gamestart时返回字段中有room_id，否则无
<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-09

---

### 9、用户击球
1.接口描述：击球方将数据传递给服务器，服务器传递给另一个玩家<br>
2.接口类型：Flask socketio<br>
3.事件名：shoot<br>
4.请求方式：客户端通过 socket.emit("shoot", data) 发送<br>
5.通信接口定义:<br>
- 客户端(击球方)->服务器端:
{
    user_id: number
    angle: number
    power: number
}
- 服务器端->客户端:
{
    event:shoot_success(给击球方)、fail(数据传递失败)、opponent_hit(给另一个玩家)
    data:{
        error: string['detail'(fail)]
        {
            angle: number;
            power: number;
        }(给另一个玩家)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-09

---

### 10、击球方发送计算结果
1.接口描述：击球方完成计算，将结果发送给服务器<br>
2.接口类型：Flask socketio<br>
3.事件名：send_pos<br>
4.请求方式：客户端通过socket.emit("send_pos", data) 发送<br>
5.通信接口定义:<br>
- 客户端(击球方)->服务器端:
{
    user_id: number
    balls:[{ball_id:number, ball_posx: number, ball_posy: numebr}...]
}
- 服务器端->客户端:
{
    event:send_success(给击球方)、fail(数据传递失败)、opponent_pos(给另一个玩家)
    data:{
        error: string['detail'(fail)]
        {
            balls: 
                [{ball_id:number, ball_posx: number, ball_posy: numebr}...]
        }(给另一个玩家)
}<br>

6.版本号：v0.1.0<br>
7.最后修改时间：11-09

---
